$(document).ready(function(){if(jQuery().tablesorter){$("table.sortable").tablesorter({widgets:["zebra"]})}$('input[name="authentication"]').click(function(){toggle_authentication(false)});$("#oem_css_info").click(function(){$("#oem_css").toggle(300);return false});if($('input[name="authentication"]').length>0){toggle_authentication(true)}$("#test_ad").click(function(){ad_test()});$('.pquery_set input[name="querytype"]').change(function(){find_scroll_set()});$(".pquery_set .cb_cb").change(function(){checkbox_options(this)});$(".param_action #cancel").click(function(){ParameterActionCancel()});$(".param_action #code").click(function(){ParameterProcCode()});$(".param_action #addparameter").click(function(){ParameterEdit(1)});$(".param_action #updateparameter").click(function(){ParameterEdit(0)});find_scroll_set();$("input[name=def_username]").each(function(){if($(this).attr("data-empty")=="1"){var b,a=this;b=setInterval(function(){$(a).val("");clearInterval(b)},500)}});$("input[name=def_password]").each(function(){if($(this).attr("data-empty")=="1"){var b,a=this;b=setInterval(function(){$(a).val("");clearInterval(b)},500)}});$("#adduser_div").click(function(){$("[name=login]").removeAttr("readonly").val("");$("[name=username]").val("");$("[name=email]").val("");$("[name=telephone]").val("");$("[name=password]").val("");$("[name=passwordC]").val("");$("[name=isadmin]").prop("checked",false);toggleEdit(0,"user");user_get_groups();$("#user_div").attr("title",$("#adduser").val()).dialog({modal:true,width:"auto"})});$("#adduser").click(function(){if(Users(1,"")){$("#user_div").dialog("close")}});$("#updateuser").click(function(){if(Users(2,"")){$("#user_div").dialog("close")}});$(document).on("click","#userlist .i_edit",function(){UserEdit(this);$("#user_div").attr("title",$("#updateuser").val()).dialog({modal:true,width:"auto"})});$(document).on("click","#userlist .i_show",function(){user_show_groups(this)})});function find_scroll_set(){var a;a=!($('.pquery_set input[name="querytype"]:checked').attr("id")=="popupquery");$(".pquery_set #pu_find").attr("disabled",a);if(a){$(".pquery_set #pu_find").prop("checked",false).next().addClass("disabled")}else{$(".pquery_set #pu_find").next().removeClass("disabled")}a=!($('.pquery_set input[name="querytype"]:checked').attr("id")=="checkbox");$(".pquery_set #checkbox_sbs").attr("disabled",a);$(".pquery_set #find").attr("disabled",a);$(".pquery_set #scroll").attr("disabled",a);$(".pquery_set #collapse").attr("disabled",a);$(".pquery_set #cb_sbs").attr("disabled",a);if(a){$(".pquery_set #checkbox_sbs").prop("checked",false).next().addClass("disabled");$(".pquery_set #find").prop("checked",false).next().addClass("disabled");$(".pquery_set #scroll").prop("checked",false).next().addClass("disabled");$(".pquery_set #collapse").prop("checked",false).next().addClass("disabled")}else{$(".pquery_set #checkbox_sbs").next().removeClass("disabled");$(".pquery_set #find").next().removeClass("disabled");$(".pquery_set #scroll").next().removeClass("disabled");$(".pquery_set #collapse").next().removeClass("disabled")}a=!($('.pquery_set input[name="querytype"]:checked').attr("id")=="radioquery");$(".pquery_set #radio_sbs").attr("disabled",a);if(a){$(".pquery_set #radio_sbs").prop("checked",false).next().addClass("disabled")}else{$(".pquery_set #radio_sbs").next().removeClass("disabled")}}function checkbox_options(b){var a=false;if($(b).attr("id")=="checkbox_sbs"){a=$(b).is(":checked")}if(a){$(".pquery_set #find").prop("checked",false);$(".pquery_set #scroll").prop("checked",false);$(".pquery_set #collapse").prop("checked",false)}else{$(".pquery_set #checkbox_sbs").prop("checked",false)}}function ad_test(){$.ajax({url:"apps/ad_test.php",data:{as:$('input[name="ad_account_suffix"]').val(),base_dn:$('input[name="ad_base_dn"]').val(),dc:$('input[name="ad_domain_controller"]').val(),user:$('input[name="ad_username"]').val(),pass:$('input[name="ad_password"]').val()},type:"get",success:function(a){alert(a)}})}function toggle_authentication(b){var c,a=["auth_mydbr","auth_sso","auth_ad"];$.each(a,function(d,f){var e=$('input[name="authentication"]:checked').val();switch(e){case"1":case"16":c="";break;case"2":c="auth_mydbr";break;case"4":c="auth_sso";break;case"8":c="auth_ad";break}if(c==f){if(b){$("."+f).show()}else{$("."+f).slideDown(300)}}else{if(b){$("."+f).hide()}else{$("."+f).slideUp(300)}}})}function GoToAbout(){document.forms.admin.app.value="about";if(document.getElementById("noheaders")){document.forms.admin.noheaders.value=""}document.forms.admin.validationRoutine.value="";document.forms.admin.submit()}function GoToMain(){window.location.href="index.php"}function Pw_Check(c,b,a){if(!document.getElementById(c).checked){document.getElementById(b).value=""}else{document.getElementById(b).value=a}}function Pw_Val(b,a){if(parseInt(document.getElementById(a).value,10)>0){document.getElementById(b).checked=true}else{document.getElementById(b).checked=false;document.getElementById(a).value=""}}function toggleEdit(d,c){var b=document.getElementById("add"+c),a=document.getElementById("update"+c);if(d==0){b.style.display="";a.style.display="none"}else{b.style.display="none";a.style.display=""}}function EditStyle(a,b,c){document.forms.admin.stylename.value=a;document.forms.admin.styleold.value=a;document.getElementById("columnstyle").checked=(b=="column");document.getElementById("rowstyle").checked=(b!="column");document.forms.admin.styledef.value=document.getElementById(c).innerHTML.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");document.forms.admin.stylename.disabled=true;toggleEdit(1,"style")}function EditParam(b,d,c,f){var e,a=new Object();d=String(d);if(c!==""&&c!==null){a=JSON.parse(c)}else{a=JSON.parse("{}")}document.forms.admin.parametername.value=b;document.forms.admin.paramold.value=b;document.getElementById("popupquery").checked=(d=="0");document.getElementById("radioquery").checked=(d=="1");document.getElementById("autocomplete").checked=(d=="2");document.getElementById("default").checked=(d=="3");document.getElementById("checkbox").checked=$.inArray(d,["4","5","6","7","8","9","10","11"])>=0;document.getElementById("checkbox_sbs").checked=false;document.getElementById("scroll").checked=$.inArray(d,["5","6","9","10"])>=0;document.getElementById("find").checked=$.inArray(d,["5","7","9","11"])>=0;document.getElementById("collapse").checked=$.inArray(d,["8","9","10","11"])>=0;e=document.getElementById(f).innerHTML.substring(5);document.forms.admin.parameterdef.value=e.substring(0,e.length-6).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");document.forms.admin.parametername.disabled=true;if($(".pquery_set #popupquery").is(":checked")){$(".pquery_set .pu_cb").each(function(){$(this).prop("checked",(a.hasOwnProperty($(this).val())))})}if($(".pquery_set #checkbox").is(":checked")){$(".pquery_set .cb_cb").each(function(){$(this).prop("checked",(a.hasOwnProperty($(this).val())))})}if($(".pquery_set #radioquery").is(":checked")){$(".pquery_set .rb_cb").each(function(){$(this).prop("checked",(a.hasOwnProperty($(this).val())))})}toggleEdit(1,"parameter");find_scroll_set();if(!$("#parameterdef").visible(true)){$.scrollTo($("input[name=parametername]"),800,{easing:"easeInOutCubic"})}}function ShowMap(){document.forms.admin.app.value="showmap";if(document.forms.admin.outputtype.value=="pdf"||document.forms.admin.outputtype.value=="dot"){document.forms.admin.noheaders.value=1}else{document.forms.admin.noheaders.value=""}}function DownloadMap(){document.forms.admin.app.value="dlmap";document.forms.admin.submit()}function EditGroup(b,a){document.forms.admin.actiontype.value="editgroup";document.forms.admin.groupid.value=b;document.forms.admin.groupname.value=a;document.forms.admin.app.value="groups";document.forms.admin.submit()}function chkAdminSumbit(){return(document.forms.admin.actiontype.value==""||document.forms.admin.actiontype.value!="back")?false:true}function GroupEdit(a){if(document.forms.admin.groupname.value==""){alert("Group name missing.")}else{if(a==1){document.forms.admin.actiontype.value="newgroup"}else{document.forms.admin.actiontype.value="updategroup"}document.forms.admin.app.value="groups";document.forms.admin.validationRoutine.value="groups_v";document.forms.admin.submit()}}function chkStyleSumbit(){return(document.forms.admin.actiontype.value=="")?false:true}function StyleEdit(a){var b=new Array();if(document.forms.admin.stylename.value==""){b.push("group name")}if(document.forms.admin.styledef.value==""){b.push("definition")}if(b.length>0){alert("Missing values: "+b.join(","))}else{if(a==1){document.forms.admin.actiontype.value="newstyle"}else{document.forms.admin.actiontype.value="updatestyle"}document.forms.admin.app.value="styles";document.forms.admin.validationRoutine.value="styles_v";document.forms.admin.submit()}}function random_string(){var d="abcdefghiklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXTZ1234567890",e=25,c="",b,a;for(b=0;b<e;b++){a=Math.floor(Math.random()*d.length);c+=d.substring(a,a+1)}return c}function url_token_get(){document.forms.admin.url_hash.value=random_string();return true}function sso_token_get(){document.forms.admin.sso_token.value=random_string();return true}function chkParamSumbit(){return(document.forms.admin.actiontype.value=="")?false:true}function ParameterEdit(c){var d=new Array(),a,b;if(document.forms.admin.parametername.value==""){d.push("Parameter query name")}if(document.forms.admin.parameterdef.value==""){d.push("Query")}if(d.length>0){alert("Missing values: "+d.join(","))}else{if(c==1){document.forms.admin.actiontype.value="newparameter"}else{document.forms.admin.actiontype.value="updateparameter"}a="";b=new Object;if($("#radioquery").is(":checked")){a="rb_cb"}if($("#checkbox").is(":checked")){a="cb_cb"}if($("#popupquery").is(":checked")){a="pu_cb"}if(a!=""){$("."+a).each(function(){if($(this).is(":checked")){b[$(this).val()]=true}})}$("input[name=paramoptions]").val(JSON.stringify(b));document.forms.admin.app.value="pquery";document.forms.admin.validationRoutine.value="param_query_v";document.forms.admin.submit()}}function SaveNotif(a){document.forms.admin.app.value="notifications";document.forms.admin.validationRoutine.value="notifications_v";document.forms.admin.submit()}function get_notif(){$.ajax({url:"apps/get_notif.php",data:{n:$("#notif").val()},type:"get",success:function(a){$("#lnotif").val(a)}})}function LicenseAdd(){if(document.forms.admin.license.value==""){alert(mydbr_loc.MYDBR_LIC_MISSING)}else{document.forms.admin.app.value="license";document.forms.admin.action.value="add";document.forms.admin.validationRoutine.value="license_v";document.forms.admin.submit()}}function LicenseDel(a){if(confirm(mydbr_loc.MYDBR_LIC_REM)){document.forms.admin.app.value="license";document.forms.admin.licid.value=a;document.forms.admin.action.value="del";document.forms.admin.validationRoutine.value="license_v";document.forms.admin.submit()}}function UserAdd(){if(document.forms.admin.username.value==""){alert(mydbr_loc.MYDBR_USER_MISSING)}else{document.forms.admin.actiontype.value="addsearchuser";document.forms.admin.app.value="groups";document.forms.admin.validationRoutine.value="groups_v";document.forms.admin.submit()}}function GroupDelete(b,a){if(confirm(sprintf(mydbr_loc.MYDBR_GROUP_REM,a))){document.forms.admin.groupid.value=b;document.forms.admin.actiontype.value="delgroup";document.forms.admin.app.value="groups";document.forms.admin.validationRoutine.value="groups_v";document.forms.admin.submit()}}function DeleteStyle(a){if(confirm(sprintf(mydbr_loc.MYDBR_STYLES_REM,a))){document.forms.admin.styleold.value=a;document.forms.admin.actiontype.value="delstyle";document.forms.admin.app.value="styles";document.forms.admin.validationRoutine.value="styles_v";document.forms.admin.submit()}}function DeleteParam(a){if(confirm(sprintf(mydbr_loc.MYDBR_PARAMQ_REM,a))){document.forms.admin.parametername.value="";document.forms.admin.paramold.value=a;document.forms.admin.actiontype.value="delparameter";document.forms.admin.app.value="pquery";document.forms.admin.validationRoutine.value="param_query_v";document.forms.admin.submit()}}function ParameterProcCode(){var a;a=$("#parameterdef").val().replace(/^\s+|\s+$/g,"");if(a.indexOf(" ")>0){window.open("index.php?a=editor")}else{window.open("index.php?a=editor&proc="+a)}}function RemoveFromGroup(b,a){if(confirm(sprintf(mydbr_loc.MYDBR_GROUP_REM_USER,b))){document.forms.admin.usertoberemoved.value=b;document.forms.admin.usertoberemovedauth.value=a;document.forms.admin.actiontype.value="removeuser";document.forms.admin.app.value="groups";document.forms.admin.validationRoutine.value="groups_v";document.forms.admin.submit()}}function ParameterActionCancel(){document.forms.admin.parametername.value="";document.forms.admin.paramold.value=name;document.forms.admin.actiontype.value="addparameter";document.forms.admin.parameterdef.value="";document.forms.admin.parametername.disabled=false;$(".pquery_set input[type=checkbox]").prop("checked",false);toggleEdit(0,"parameter")}function StyleActionCancel(){document.forms.admin.stylename.value="";document.forms.admin.styleold.value="";document.getElementById("columnstyle").checked=true;document.getElementById("rowstyle").checked=false;document.forms.admin.styledef.value="";document.forms.admin.stylename.disabled=false;toggleEdit(0,"style")}function GroupActionCancel(){toggleEdit(0,"group");document.forms.admin.groupid.value="";document.forms.admin.groupname.value="";document.forms.admin.app.value="groups";document.forms.admin.submit()}function UserAddSelected(d){var c=new Array(),b=new Array(),e,f,g,a;e=document.getElementById(d);f=e.getElementsByTagName("tr").length;for(g=1;g<f;g++){a=document.getElementById(d+"cb"+g);if(a){if(a.checked){c.push(e.rows[g].cells[1].innerHTML);b.push(e.rows[g].cells[4].innerHTML)}}}document.forms.admin.tobeadded.value=c.join(",");document.forms.admin.tobeaddedid.value=b.join(",");if(document.forms.admin.tobeadded.value==""){alert("No rows selected");return false}else{document.forms.admin.actiontype.value="addselectedusers";document.forms.admin.app.value="groups";document.forms.admin.validationRoutine.value="groups_v";document.forms.admin.submit();return true}}function trim(a){return a.replace(/^\s+|\s+$/g,"")}function Users(g,c,f){var a,b=false,d,e;if(f===undefined){f=2}d=$("[name=password]").val();if(g!=3){if(d!=""){if(d!=$("[name=passwordC]").val()){alert(mydbr_loc.MYDBR_APASSWORD_NOMATCH);return false}if(!$("[name=isadmin]").is(":checked")){e=Pw_RulesCheck(d,$("#pwm").val(),$("#pwl").val(),$("#pwn").val(),$("#pws").val());if(!e){return false}}}}if(c==""){a=trim($("[name=login]").val())}else{a=c}if(g!=0&&a==""){b=true}if((g==1||g==2)&&trim($("[name=username]").val())==""){b=true}if(b){alert("Please enter the Login info.");return false}if(g!=3){d=$("[name=password]").val();if(d!=""){if($("#salted_hash").val()=="1"){d=d}else{d=hex_md5(unescape(encodeURIComponent(d)))}}}$.ajax({url:"apps/user.php",type:"post",async:false,data:{id:g,login:a,username:$("[name=username]").val(),password:d,isadmin:$("[name=isadmin]").is(":checked")?1:0,email:$("[name=email]").val(),telephone:$("[name=telephone]").val(),authentication:f,askpwchange:$("[name=askpwchange]").is(":checked")?1:0,csrf_token:csrf_token_get()},success:function(i){if(g==1||g==2){var j=[],h;$("[name=useringroup]:checked").each(function(){j.push($(this).attr("data-id"))});h=j.join(",");$.ajax({url:"apps/user_groups_set.php",type:"post",async:false,data:{login:a,authentication:f,csrf_token:csrf_token_get(),groups:h}})}$("#users").html(i);UserCancel()},error:function(){alert("An error occurred during query")}});return true}function UserCancel(){toggleEdit(0,"user");$("[name=login]").attr("readonly","readonly").val("");$("[name=username]").val("");$("[name=email]").val("");$("[name=telephone]").val("");$("[name=password]").val("");$("[name=passwordC]").val("");$("[name=isadmin]").attr("checked",false);$("#passhlp").css("display","none")}function user_get_groups(a,b,c){if(c===undefined){c=".user_groups"}$.ajax({url:"apps/user_groups.php",async:false,type:"get",data:{login:a,authentication:b},success:function(d){$(c).html(d)}})}function user_show_groups(a){user_get_groups(getTableCell(a,0),getTableCell(a,10),".user_groups_no_edit");$(".user_groups_no_edit input").on("change",function(){this.checked=!this.checked});$(".user_groups_no_edit").attr("title",getTableCell(a,1)).dialog({modal:true,width:"auto",height:300})}function UserEdit(a){user_get_groups(getTableCell(a,0),getTableCell(a,10));$("[name=login]").val(getTableCell(a,0));$("[name=username]").val(getTableCell(a,1));$("[name=email]").val(getTableCell(a,3));$("[name=telephone]").val(getTableCell(a,4));$("#passhlp").css("display","inline");$("[name=isadmin]").attr("checked",(getTableCell(a,9)==1));$("[name=askpwchange]").attr("checked",false);toggleEdit(1,"user");$("[name=login]").attr("readonly","readonly");$("#usern").focus()}function UserDelete(a){if(confirm(sprintf(mydbr_loc.MYDBR_USER_REM,getTableCell(a,0)))){Users(3,getTableCell(a,0),getTableCell(a,10))}}function ImgSel(){if(document.forms.admin.imagechart.checked){document.forms.admin.image_preferred_1.disabled=false}else{document.forms.admin.image_preferred_0.checked=true;document.forms.admin.image_preferred_1.checked=false;document.forms.admin.image_preferred_1.disabled=true}};