$(document).ready(function(){var a,b={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]};window.editor=CodeMirror.fromTextArea(document.getElementById("template"),{mode:b,selectionPointer:true,styleActiveLine:true,autoCloseBrackets:true,matchBrackets:true,indentWithTabs:!editor_prefs.indent_with_space,smartIndent:true,lineNumbers:true,matchBrackets:true,autofocus:true,indentUnit:2,keyMap:editor_prefs.keymap,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],fold:"indent",foldGutter:{rangeFinder:new CodeMirror.fold.combine(CodeMirror.fold.indent,CodeMirror.fold.comment)},extraKeys:{"Ctrl-Space":"autocomplete","Shift-Tab":"indentLess","Ctrl-Q":function(c){c.foldCode(c.getCursor())},Tab:"indentMore",Esc:function(c){if(c.getOption("fullScreen")){c.setOption("fullScreen",false)}},"Ctrl-S":function(c){save_template()},"Cmd-S":function(c){save_template()}},theme:editor_prefs.theme});resize_codemirror(0);window.buffers={};buffers["0"]=editor_tab_init();buffers["1"]=editor_tab_init();buffers["2"]=editor_tab_init();a=true;$(window).resize(function(){if(a){resize_codemirror(1)}});$(document).on("click","#search",function(c){if(c.shiftKey){CodeMirror.commands.replace(editor)}else{CodeMirror.commands.find(editor)}});$(document).on("click","#word_wrap",function(){window.editor.setOption("lineWrapping",!window.editor.getOption("lineWrapping"))});$(document).on("click","#fullscreen",function(){window.editor.setOption("fullScreen",!window.editor.getOption("fullScreen"))});$(document).on("click","#newtemplate",function(){$("#template_id").val("");$("#template_name").val("");template_set_tab_content("","","");$("#template_name").focus()});if(jQuery().tablesorter){$("table.sortable").tablesorter({widgets:["zebra"]})}$("#preview").click(function(){template_show_in_window()});$("#cancel").click(function(){if(confirm(mydbr_loc.MYDBR_AA_DISCARD)){$("#template_id").val("");$("#template_name").val("");template_set_tab_content("","","");template_clear_edited("template")}});template_drag_drop();$(document).on("change","#template_folders",function(){$("#template_folder_id").val($(this).val());template_list_get()});$(document).on("click","#tab_browsing_list div.tab",function(){editor_tab_select($(this).closest("li"))});$(document).on("click","#newfolder",function(){jPrompt("","",mydbr_loc.MYDBR_TEMPLATE_ADD_FOLDER,new_template_folder)});$(document).on("dblclick",".template_in_list.folder, .template_in_list.folder_up",function(d){if(d.altKey){var e,c;e=$(this).parent().attr("data-id");c=$(this).parents(".row").children().first().text();template_folder_rename_p(e,c)}else{$("#template_folder_id").val($(this).parent().attr("data-id"));template_list_get()}});$(document).on("click",".template_in_list.template",function(){$(this).closest(".rows").children().removeClass("selected");$(this).parent().addClass("selected");template_get("template",$(this).parent().attr("data-id"),$(this).text())});$(document).on("click",".folder.i_delete",function(){var c=$(this).parents(".row").children().first();if(confirm("Delete folder '"+c.text()+"'?")){template_del(c.parent().attr("data-id"),"folder")}});$(document).on("click",".template.i_delete",function(){var c=$(this).parents(".row").children().first();if(confirm(sprintf(mydbr_loc.MYDBR_TEMPLATE_DELETE,c.text()))){template_del(c.parent().attr("data-id"),"template")}});$("#save").click(function(){save_template()})});function template_folder_rename_p(b,a){window.template_rename_id=b;jPrompt("",a,mydbr_loc.MYDBR_FOLDER_NAME,template_folder_rename)}function new_template_folder(b){var a=$("#template_folder_id").val();$.ajax({url:"apps_v/template_folder_action.php",type:"post",data:{id:a,name:b,action:"new",csrf_token:csrf_token_get()},success:function(c){template_list_get()}})}function template_folder_rename(a){$.ajax({url:"apps_v/template_folder_action.php",type:"post",data:{id:window.template_rename_id,name:a,action:"rename",csrf_token:csrf_token_get()},success:function(b){template_list_get()}})}function template_drag_drop(){$(".row.template,.row.folder").draggable({containment:"#templatelist",opacity:0.5,revert:true,revertDuration:0});$(".row.folder,.row.folder_up").droppable({hoverClass:"drop_highlite",drop:function(b,c){var e=c.draggable.attr("data-id"),d=$(this).attr("data-id"),a=c.draggable.hasClass("template")?"template":"folder";$.ajax({url:"apps_v/template_to_folder.php",type:"post",data:{id:e,target:d,type:a,csrf_token:csrf_token_get()},success:function(f){template_list_get()}})}})}function template_clear_edited(a){}function template_set_tab_content(e,c,d){var a,b;e=e===null?"":e;c=c===null?"":c;d=d===null?"":d;editor_tab_set_text(0,e);editor_tab_set_text(1,c);editor_tab_set_text(2,d);b=$("#tab_browsing_list li.selected").attr("data-id");switch(b){case"0":a=e;break;case"1":a=c;break;case"2":a=d;break}editor.setValue(a)}function template_del(b,a){$.ajax({url:"apps_v/template_del.php",type:"post",data:{id:b,csrf_token:csrf_token_get(),type:a},success:function(c){template_list_get()}})}function template_get(a,c,b){$.ajax({url:"apps_v/template_get.php",type:"get",data:{id:c},dataType:"json",success:function(d){if(d.length==3){$("#template_id").val(c);$("#template_name").val(b);template_set_tab_content(d[0],d[1],d[2]);template_clear_edited(a)}else{if(d.length==1){alert(d[0])}}}})}function template_show_in_window(){var b,a,c=$("#template_name").val();if(!a||!a.open){b=location.href.substring(0,location.href.lastIndexOf("/")+1);a=window.open("",c,"");a.document.write("<html><head><title>"+c+"</title>");a.document.write('<link rel="stylesheet" type="text/css" href="'+b+'interface/style.css">');a.document.write('<link rel="stylesheet" type="text/css" href="'+b+'interface/normal.css">');a.document.write('</head><body><div class="content template">');a.document.write(editor_tab_get_text(0));a.document.write(editor_tab_get_text(1));a.document.write(editor_tab_get_text(2));a.document.write("</div></body></html>")}}function save_template(){var e,a,d,b,c;template_id="template";e=$("#template_id").val();a=$.trim($("#template_name").val());if(a==""){alert(mydbr_loc.MYDBR_AA_MISSING_NAME);return}d=editor_tab_get_text(0);b=editor_tab_get_text(1);c=editor_tab_get_text(2);$.ajax({url:"apps_v/template_save.php",type:"post",data:{id:e,name:a,header:d,row:b,footer:c,folder_id:$("#template_folder_id").val(),csrf_token:csrf_token_get()},success:function(g){var f;if(g=="1"){f=500;$.blockUI.defaults.growlCSS.width="auto";$.blockUI.defaults.growlCSS.left="10px";$.blockUI.defaults.growlCSS.right="";$.blockUI.defaults.growlCSS.opacity=0.9;$.blockUI.defaults.growlCSS.backgroundColor="#000";$.growlUI(null,mydbr_loc.MYDBR_TEMPLATE_SAVED,f);$("#template_id").val("");$("#template_name").val("");template_set_tab_content("","","");template_clear_edited(template_id);template_list_get()}if(g=="0"){f=1500;$.blockUI.defaults.growlCSS.width="auto";$.blockUI.defaults.growlCSS.left="10px";$.blockUI.defaults.growlCSS.right="";$.blockUI.defaults.growlCSS.opacity=0.9;$.blockUI.defaults.growlCSS.backgroundColor="red";$.growlUI(null,mydbr_loc.MYDBR_TEMPLATE_SAVE_DUPLICATE,f)}}})}function template_list_get(){$.ajax({url:"apps_v/template_list_get.php",type:"get",data:{id:$("#template_folder_id").val()},success:function(a){$("#templatelist").html(a);template_drag_drop()}})};