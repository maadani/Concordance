var divs_timeout,divs_words=[],resultwindow;$(document).ready(function(){var g,a,f,b;if($("#db_vendor").val()=="mysql"){g="text/x-mysql"}else{g="text/x-mssql"}f=/Mac/.test(navigator.platform)?"Cmd":"Ctrl";window.editor=CodeMirror.fromTextArea(document.getElementById("code"),{mode:g,styleActiveLine:true,autoCloseBrackets:true,matchBrackets:true,indentWithTabs:!editor_prefs.indent_with_space,smartIndent:false,lineNumbers:true,autofocus:true,indentUnit:2,keyMap:editor_prefs.keymap,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],fold:"indent",foldGutter:{rangeFinder:new CodeMirror.fold.combine(CodeMirror.fold.indent,CodeMirror.fold.comment)},extraKeys:{"Ctrl-Space":"autocomplete","Shift-Tab":(editor_prefs.indent_with_space?"indentLess":null),"Ctrl-Q":function(h){h.foldCode(h.getCursor())},Tab:(editor_prefs.indent_with_space?"indentMore":null),Esc:function(h){if(h.getOption("fullScreen")){h.setOption("fullScreen",false)}}},theme:editor_prefs.theme});editor.options.extraKeys[f+"-E"]=executeSQL;editor.options.extraKeys[f+"-S"]=function(h){if(isIE()){return}window.open("data:text/plain;charset=utf-8,"+encodeURIComponent(h.getValue()))};editor.options.extraKeys[f+"-G"]=function(h){editor_search_find_do(event)};editor.options.extraKeys[f+"-E"]=executeSQL;editor.options.extraKeys[f+"-F"]=editor_search_find;editor.options.extraKeys[f+"-Alt-F"]=editor_search_find;editor.options.extraKeys["Shift-"+f+"-G"]=function(h){editor_search_find_do(event)};function c(h,k){var j=(k===undefined)?false:((k.keyCode?k.keyCode:k.charCode)==46?true:false);return(h.string.substr(0,1)=='"'||h.string.substr(0,1)=="'")&&(h.string.substr(1,4)==="dbr."||(h.string.substr(1,3)==="dbr"&&j))}if(editor_prefs.autocomplete_mydbr){window.editor.on("keypress",function(h,k){var j=h.getTokenAt(h.getCursor());if($(".CodeMirror-hint-active").length==0){if(c(j,k)){CodeMirror.showHint(h,CodeMirror.hint.mydbr)}}})}CodeMirror.registerHelper("hint","mydbr",function(n,k){var o=n.getCursor(),h=[],m=n.getTokenAt(o),p,j,l;if(m.end>o.ch){m.end=o.ch;m.string=m.string.slice(0,o.ch-m.start)}p=j=o.ch;p=p-m.string.length+5;for(l=0;l<mydbr_cmds.length;l++){if(m.string.substring(1)==mydbr_cmds[l].substring(0,m.string.length-1)){h.push(mydbr_cmds[l].substr(4))}}return{list:h.sort(),from:CodeMirror.Pos(o.line,p),to:CodeMirror.Pos(o.line,j)}});CodeMirror.commands.autocomplete=function(h){var j=h.getTokenAt(h.getCursor());if(c(j)){CodeMirror.showHint(h,CodeMirror.hint.mydbr)}else{CodeMirror.showHint(h,CodeMirror.hint.sql)}};function e(){var h=(editor.options.mode=="text/x-mysql");insertAtCaret("select 'dbr.'"+(h?";":""));editor.execCommand("goCharLeft");if(h){editor.execCommand("goCharLeft")}if(editor_prefs.autocomplete_mydbr){CodeMirror.showHint(editor,CodeMirror.hint.mydbr)}}if(editor_prefs.keymap==="sublime"){editor.options.extraKeys["Ctrl-Alt-M"]=function(h){e()}}else{editor.options.extraKeys["Ctrl-M"]=function(h){e()}}$(".shortcut").each(function(){if($(this).val()!==""){var h=$(this);editor.options.extraKeys[$(this).val()]=function(j){cr=parseInt(h.closest(".snippet").attr("data-right"),10);cd=parseInt(h.closest(".snippet").attr("data-down"),10);insertAndIndent(h.siblings(".code").attr("data-code"),cr,cd)}}});for(a in window.editor_prefs.macros){editor.options.extraKeys[a]=function(j){var h="";if(event.ctrlKey){h+="Ctrl-"}if(event.altKey){h+="Alt-"}h+=String.fromCharCode(event.keyCode).toUpperCase();lines=window.editor_prefs.macros[h].code.split("\n");for(i=0;i<lines.length;i++){insertAtCaret(lines[i]);if(i<lines.length-1){j.execCommand("newlineAndIndent")}}for(afterc in window.editor_prefs.macros[h].after){j.execCommand(window.editor_prefs.macros[h].after[afterc])}}}window.buffers={};buffers["0"]=editor_tab_init();buffers["1"]=editor_tab_init();buffers["2"]=editor_tab_init();buffers["0"].text=$("#q0").text();buffers["2"].text=$("#q2").text();table_hints(window.editor_prefs.autocomplete_db);resize_codemirror(0);b=true;$(window).resize(function(){if(b){resize_codemirror(1)}});$(document).on("click","#db_autocomplete div div",function(){var h=$(this).parent().find(".cm").text();if(h==String.fromCharCode(160)){h="&#10003;";$(this).parent().find(".db").addClass("adb")}else{h="&nbsp;";$(this).parent().find(".db").removeClass("adb")}$(this).parent().find(".cm").html(h)});$(document).on("click","#editor_keyboard",function(){$("#keyboard_shortcuts").dialog({})});$(document).on("click","#snippets_show",function(){var k,h,j=editor.getSelection();if(j==""){$("#snippets").dialog({height:525,width:525,minWidth:525,minHeight:253,close:function(l,m){editor.focus()}})}else{h=window.prompt(mydbr_loc.MYDBR_SQLEDIT_SNIPPET_NEW);if(h){$.ajax({url:"apps_v/snippets_v.php",type:"post",data:{action:"save",id:0,name:h,code:j,csrf_token:csrf_token_get()},success:function(l){$("#snippets").html(l);SyntaxHighlighter.highlight();editor.setSelection(editor.getCursor())}})}}});$(document).on("keydown",".snippet .shortcut",function(m){var h,k,l,j={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"};if(!j.hasOwnProperty(m.keyCode)){h=m.keyCode;k=get_editor_keycode(m);if(h>=65&&h<=90||h==8){l=$(this).val();if(l!=""){delete editor.options.extraKeys[$(this).val()]}if(h==8){$(this).val("")}else{$(this).val(k);editor.options.extraKeys[k]=function(n){$(".shortcut").each(function(){if($(this).val()==k){insertAndIndent($(this).siblings(".code").attr("data-code"))}})}}$.ajax({url:"apps_v/snippets_v.php",type:"post",data:{action:"shortcut",id:$(this).closest(".snippet").attr("data-id"),shortcut:k,csrf_token:csrf_token_get()}})}}return false});$(document).on("click",".flip-container .back .hide_move",function(h){$(this).closest(".flip-container").removeClass("flip")});$(document).on("click",".flip-container .back .save_move",function(j){var k,h=$(this).closest(".snippet");k=h.attr("data-id");$.ajax({url:"apps_v/snippets_v.php",type:"post",data:{action:"save_move",id:k,right:$(this).closest(".back").find('[name="right"]').val(),down:$(this).closest(".back").find('[name="down"]').val(),csrf_token:csrf_token_get()},success:function(l){$("#snippets").html(l);SyntaxHighlighter.highlight()}})});var d=0;$(document).on("click",".snippet .code",function(j){var m=new Date(),l=m.getTime(),h,k;if(d+250<l){h=parseInt($(this).closest(".snippet").attr("data-right"),10);k=parseInt($(this).closest(".snippet").attr("data-down"),10);d=l;insertAndIndent($(this).attr("data-code"),h,k,j);editor.focus()}});$(document).on("click",".flip-container .move_cursor",function(h){$(this).closest(".flip-container").addClass("flip");return false});$(document).on("click",".snippet .close",function(){var j,h=$(this).closest(".snippet");j=h.attr("data-id");if(window.confirm(mydbr_loc.MYDBR_SQLEDIT_SNIPPET_DELETE+" '"+h.find(".name").text()+"'?")){$.ajax({url:"apps_v/snippets_v.php",type:"post",data:{action:"delete",id:j,csrf_token:csrf_token_get()},success:function(k){$("#snippets").html(k);SyntaxHighlighter.highlight()}})}return false});$(document).on("click","#editor_prefs",function(){$("#db_autocomplete").height(115);$("#db_autocomplete_scrollout").height(117);$("#prefs").dialog({autoOpen:true,height:360,width:500,maxWidth:500,minWidth:500,minHeight:253,buttons:{OK:function(){var j,n,h,l,k,m=[];$("#db_autocomplete .adb").each(function(){m.push($(this).text())});j=this;k=JSON.stringify(m);l=$("#theme_select").val();h=$("#editor_keymap").val();n=$("#indent_with_spaces").prop("checked")?1:0;$.ajax({url:"apps_v/editor_prefs.php",type:"post",data:{adbs:k,theme:l,keymap:h,indent_with_spaces:n,csrf_token:csrf_token_get()},success:function(){$(j).dialog("close")}})}},resize:function(h,j){$("#db_autocomplete").height($(this).height()-120);$("#db_autocomplete_scrollout").height($(this).height()-118)}})});$(document).on("click","#new_document",function(){editor_tab_new()});$(document).on("click","#save",function(){window.open("data:text/plain;charset=utf-8,"+encodeURIComponent(window.editor.getValue()))});$(document).on("click","#search",function(h){editor_search_find()});$(document).on("click","#word_wrap",function(){window.editor.setOption("lineWrapping",!window.editor.getOption("lineWrapping"))});$(document).on("click","#fullscreen",function(){window.editor.setOption("fullScreen",!window.editor.getOption("fullScreen"))});$(document).on("click","#tab_browsing_list div.tab",function(){editor_tab_select($(this).closest("li"))});$(document).on("click","#tab_browsing_list div.close",function(){editor_tab_close($(this).closest("li"))});$(".CodeMirror").resizable({handles:"s",start:function(){b=false},stop:function(){b=true},resize:function(){editor.setSize("100%",$(this).height());editor.space_below=$(window).height()-$(".CodeMirror").height()-$(".CodeMirror").offset().top}});$("#show_obj").click(function(){getObject()});$("#browser").click(function(){$("#sqleditor").slideToggle(300,function(){resize_codemirror(1)});swap_value(this,mydbr_loc.MYDBR_EDITREPORT_SHOW_QUERY_BUILDER,mydbr_loc.MYDBR_EDITREPORT_HIDE_QUERY_BUILDER);return false});$("#comment").click(function(h){comment_code(parseInt($(this).attr("data-dashes"),10),h.altKey);return false});$("#cmdbrowser").click(function(){$("#cmds").slideToggle(300,function(){resize_codemirror(1)});swap_value(this,mydbr_loc.MYDBR_EDITREPORT_SHOW_CMDS,mydbr_loc.MYDBR_EDITREPORT_HIDE_CMDS);if($("#cmds").is(":visible")&&$("#catcmd").children().length==0){$("#category div.tblrow").first().trigger("click")}return false});$("#exe_sql").click(function(){executeSQL()});$("#db div.tblrow").click(function(){get_tables(this);return false});$("#gensql").click(function(){gensql(false);return false});$("#gensqln").click(function(){gensql(true);return false});$("#inscmd").click(function(){insert_command();return false});$("#qsel").sortable();$("#category div.tblrow").click(function(){showcommands(this);return false});$("#table_scrollout").resizable({alsoResize:"#table_scroll,#table_scrollout,#table",handles:"e,w"});$("#recover").click(function(){recover_proc()});$(document).on("dblclick",".recover_proc td",function(){recover_item(this,"proc")});$(document).on("dblclick",".recover_cmd td",function(){recover_item(this,"cmd")});$(".proc_editor_result").click(function(){$.scrollTo($("#editor_result"),400,{easing:"easeInOutCubic"})});$(document).on("change","#theme_select",function(){window.editor.setOption("theme",$(this).val())})});function get_editor_keycode(a){s="";if(a.shiftKey){s+="Shift-"}if(a.ctrlKey){s+="Ctrl-"}if(a.metaKey){s+="Cmd-"}if(a.altKey){s+="Alt-"}s+=String.fromCharCode(a.keyCode);return s}function insertAndIndent(g,d,b,h){var j=(h===undefined)||!h.altKey,m,k,l,a,n=g.replace(/\\n/g,String.fromCharCode(10)).split("\n");if(d===undefined){d=0}if(b===undefined){b=0}k=editor.getCursor();l=editor.getLine(k.line).substr(0,k.ch);l=l.replace(/[^\s]/g," ");m="";for(var f=0;f<n.length;f++){if(f>0&&j){m+=l}m+=n[f];if(f<n.length-1){m+="\n"}}insertAtCaret(m);editor.setCursor(k);while(b>0){editor.execCommand("goLineDown");b--}while(d>0){editor.execCommand("goColumnRight");d--}}function insertmyDBRCmd(){var a=(editor.options.mode=="text/x-mysql");insertAtCaret("select 'dbr.'"+(a?";":""));editor.execCommand("goCharLeft");if(a){editor.execCommand("goCharLeft")}}function table_hints(a){if(a.length){$.getJSON("apps/editor_hints.php",{db:JSON.stringify(a)},function(b){editor.options.hintOptions=b})}}function recover_proc(){$.ajax({url:"apps/recover.php",type:"get",success:function(a){$("#recover_dialog").html(a).dialog({width:"auto",resizable:false})}})}function recover_item(c,a){var b=$(c).closest("tr");$.ajax({url:"apps/recover_proc.php",type:"get",data:{id:b.attr("data-recover_id"),type:a},success:function(d){var e;if(a=="proc"){e=b.find("td:eq(0)").text()+" - "+b.find("td:eq(1)").text()}else{e=b.find("td:eq(0)").text()}editor_tab_new(e,d)}})}function getSelectedText(a){var b=window.editor.getSelection();if(b===""&&a){b=window.editor.getValue()}return b}function comment_code(h,k){var g,b,j,n,e,m=window.editor.getSelection(),d,l=false,f,a,c;n=m.split("\n");b=true;e="";j="";c=editor.listSelections();d=(c[0].anchor.ch==0||c[0].head.ch==0);if(n[n.length-1]==""){n.pop();l=true}for(g=0;g<n.length;g++){if(n[g]==""){j+="\n";e+="\n"}else{if(n[g].substr(0,3)!=="-- "){if(n[g]!==""){b=false}j+=((n[g]!=="")?"-- ":"")+n[g]+"\n"}else{e+=n[g].substr(3)+"\n"}}}if(!d){b=false}if(b){if(!l&&e.substr(-1)=="\n"){e=e.substr(0,e.length-1)}editor.replaceSelection(e);return}if($.trim(m).substr(0,2)=="/*"&&$.trim(m).substr(-2)=="*/"){if(m.substr(3,1)=="\n"){g=1}else{g=0}a=(m.substr(-1)=="\n"&&n.length==1);m=$.trim(m);m=m.substr(2+g).substr(0,m.length-4-g);if(m.substr(0,1)=="\n"){m=m.substr(1)}if(!d&&m.substr(0,1)==" "&&m.substr(-1)==" "){m=m.substr(1).substr(0,m.length-2)}if(n.length==1){if(m.substr(0,1)==" "){m=m.substr(1)}if(m.substr(-1)==" "){m=m.substr(0,m.length-1)}}editor.replaceSelection(m+(a?"\n":""))}else{f=(n.length<=h);if(k){f=!f}if(f&&d){if(!l&&j.substr(-1)=="\n"){j=j.substr(0,j.length-1)}editor.replaceSelection(j);return}a=false;if(m.substr(-1)=="\n"){m=m.substr(0,m.length-1);a=true}if(n.length>1){editor.replaceSelection("/*\n"+m+"\n*/\n")}else{editor.replaceSelection("/* "+m+" */"+(a?"\n":""))}}}function swap_value(c,b,a){c.value=(c.value==b?a:b)}function insert_command(){var a,b;if($("#catcmd .selected").length>0){a=$("#db_vendor").val()=="mysql"?";":"";b=$($("#catcmd .selected").children()[2]).text()+a+"\n";insertAtCaret(b)}else{alert("Please select the command to be inserted.")}}function showcommands(b){$(b).parent().children().each(function(){$(this).removeClass("selected")});$(b).addClass("selected");var a=$($(b).children()[1]).text();$.ajax({url:"apps/cmdhelper.php",type:"get",data:{cmdhelp:a},success:function(c){$("#catcmd").html(c);$("#catcmd div.tblrow").click(function(){select_command(this)});$("#catcmd div.tblrow").dblclick(function(){dblclick_command(this)})}})}function dblclick_command(a){select_command(a);insert_command()}function select_command(a){$(a).parent().children().each(function(){$(this).removeClass("selected")});$(a).addClass("selected")}function search_divtable(c,j,a){var e=a.keyCode,f=c.value.toLowerCase().split(" "),b,d,h;clearTimeout(divs_timeout);divs_timeout=setTimeout(function(){g(e)},600);function g(l){var k=[9,16];if(array_identical(f,divs_words)||$.inArray(l,k)>=0){return}divs_words=f;$("#"+j).children().each(function(){b=$(this).text().replace(/<[^>]+>/g,"");h="none";for(d=0;d<f.length;d++){if(b.toLowerCase().indexOf(f[d])>=0){h=""}else{h="none";break}}$(this).css("display",h)})}}function insertAtCaret(a){var b=editor.getCursor();editor.replaceRange(a,CodeMirror.Pos(b.line,b.ch))}function get_tables(b){$(b).parent().children().each(function(){$(this).removeClass("selected")});$(b).addClass("selected");var a=$($(b).children()[0]).text();$.ajax({url:"apps_v/sqleditor_v.php",type:"get",data:{type:"db",object:a,object_sub:""},success:function(c){$("#table").html(c);$("#table div.tblrow").click(function(){var d=$(this).children(":last").text();get_columns(this,$(this).children(":first").text(),d,"s")});$("#table div.tblrow").dblclick(function(){var d=$(this).children(":last").text();get_columns(this,$(this).children(":first").text(),d,"d")});get_columns(null,"","","")}})}function column_title(b,a){$(".col_hdr").html(b);$(".dt_hdr").html(a)}function get_report(a,b){$.ajax({url:"apps_v/sqleditor_v.php",type:"get",data:{type:"P",object:a,object_sub:b},success:function(c){$("#column").html(c);if(c!=""){column_title(mydbr_loc.MYDBR_SQLEDIT_REPORT,"")}else{column_title(mydbr_loc.MYDBR_SQLEDIT_ROUTINE,"")}}})}function get_columns(e,c,b,d){$(e).parent().children().each(function(){$(this).removeClass("selected")});$(e).addClass("selected");var a=$($("#db .selected").children()[0]).text();if(c==""||a==""){$("#column").html("");column_title(mydbr_loc.MYDBR_SQLEDIT_COLUMN,mydbr_loc.MYDBR_SQLEDIT_DATATYPE);return}if(d=="d"&&b!="T"){if(b=="P"){get_report(a,c)}edit_obj(c,a);return}if(d=="s"&&b!="T"){if(b=="P"){get_report(a,c)}return}$.ajax({url:"apps_v/sqleditor_v.php",type:"get",data:{type:b,object:a,object_sub:c},success:function(f){$("#column").html(f);column_title(mydbr_loc.MYDBR_SQLEDIT_COLUMN,mydbr_loc.MYDBR_SQLEDIT_DATATYPE);$("#column div.tblrow").click(function(){get_select(this,$(this).children(":first").text())})}})}function get_select(f,d){var a,e,c,b;$(f).parent().children().each(function(){$(this).removeClass("selected")});$(f).addClass("selected");a=$($("#db .selected").children()[0]).text();e=$($("#table .selected").children()[0]).text();if(d=="*"){b=""}else{b='<option value="sum">sum</option><option value="min">min</option><option value="max">max</option><option value="avg">avg</option>'}c='<select><option value="none" selected="selected">None</option>'+b+'<option value="count">count</option></select>';if(!sel_exist(a,e,d)){$("#qsel").append('<div class="tblrow"><div class="col_sel_db">'+a+'</div><div title="'+e+'" class="col_sel_table">'+e+'</div><div title="'+d+'" class="col_sel_col">'+d+'</div><div class="col_sel_aggr">'+c+'</div><div class="col_sel_del"><div class="i_delete">&nbsp;</div></div></div>');$("#qsel").children(":last").children(":last").click(function(){$(this).parent().remove()})}}function sel_exist(b,d,c){var a=false;$("#qsel").children().each(function(){var e,f,g;e=$($(this).children()[0]).text();f=$($(this).children()[1]).text();g=$($(this).children()[2]).text();if(e==b&&f==d&&g==c){a=true;$(this).effect("highlight",{},500)}});return a}function gensql(a){var b=new Array();$("#qsel").children().each(function(){var c=$(this).children();b.push(new Array($(c[0]).text(),$(c[1]).text(),$(c[2]).text(),$($($(c[3]).children())[0]).val()))});if(b.length<1){alert("Please select the columns first.");return}$.ajax({url:"apps/gen_sql.php",type:"post",data:{query:$.toJSON(b)},success:function(d){var e,c;if(a){editor_tab_new("Generated",d)}else{e="select \nfrom \nwhere ";c="";if(c.search(e)>0){}else{insertAtCaret(d)}}}})}function executeSQL(){var d,c=getSelectedText(true),b=$("#newwin").is(":checked"),a=$("#output_as_sql").is(":checked");if(b&&(!resultwindow||!resultwindow.open)){d=location.href.substring(0,location.href.lastIndexOf("/")+1);resultwindow=window.open("","Result window","");resultwindow.document.write("<html><head><title>Query result</title>");resultwindow.document.write('<link rel="stylesheet" type="text/css" href="'+d+'interface/themes/blue.css">');resultwindow.document.write('<link rel="stylesheet" type="text/css" href="'+d+'interface/normal.css">');resultwindow.document.write('<link rel="stylesheet" type="text/css" href="'+d+'interface/style.css">');resultwindow.document.write('<link rel="stylesheet" type="text/css" href="'+d+'interface/sqleditor.css">');resultwindow.document.write('<style type="text/css">.editor_result td{ border-bottom: 1px solid #CCC; padding: 0.3em 1em}\n.editor_result tr:hover td{  background-color: rgb(179, 255, 0); cursor: pointer}\n.editor_result th{ background: #CCC } \nbody{padding:1em}\n</style>');resultwindow.document.write('</head><body><div id="result"></div></body></html>')}if(b){a=false}$.ajax({url:"apps_v/procEditor_v.php",type:"post",data:{query:c,newwin:b,output_as_sql:a,csrf_token:csrf_token_get(),format:"text"},error:function(h,f,k){var j,g=$(h.responseText).text();if(g==""){g=h.responseText}if(h.status===0){j="No connect.\n Verify Network."}else{if(h.status==404){j="Requested page not found. [404]"}else{if(h.status==500){j="Internal Server Error [500]."}else{if(exception==="parsererror"){j="Requested JSON parse failed."}else{if(exception==="timeout"){j="Time out error."}else{if(exception==="abort"){j="Ajax request aborted."}else{j="Uncaught Error.\n"+h.status}}}}}}j+='<pre class="exec_error">'+j+"\n"+g+"</pre>";$("#editor_result").html(j);$(".proc_editor_result").text("Error").addClass("exec_error").css("display","inline-block");$.scrollTo($(".proc_editor_result"),800,{easing:"easeInOutCubic"})},success:function(f){var g,e;if(f.substring(0,5)=="ERROR"){a=false;f=f.substring(5)}if(a){editor_tab_new("SQL",f)}else{if(b){e=document.createElement("div");e.innerHTML=f;resultwindow.document.getElementById("result").appendChild(e);if(resultwindow.document.body.scrollHeight){resultwindow.scrollTo(0,resultwindow.document.body.scrollHeight)}}else{$("#editor_result").html(f);g=$(".querytime").last().find("span").text();if(g){if($("#editor_result").find(".enote_left").length){$(".proc_editor_result").text(g).addClass("exec_error").css("display","inline-block")}else{$(".proc_editor_result").text(g).removeClass("exec_error").css("display","inline-block")}}else{$(".proc_editor_result").hide()}if($(".procsaved").length){$("#addreport").show()}else{$("#addreport").hide()}}}}});return false}function setSelectionRange(b,c,d){if(b.setSelectionRange){b.focus();b.setSelectionRange(c,d)}else{if(b.createTextRange){var a=b.createTextRange();a.collapse(true);a.moveEnd("character",d);a.moveStart("character",c);a.select()}}}function replaceSelection(d,a){var c,b,e,f;if(d.setSelectionRange){e=d.selectionStart;f=d.selectionEnd;d.value=d.value.substring(0,e)+a+d.value.substring(f);if(e!=f){setSelectionRange(d,e,e+a.length)}else{setSelectionRange(d,e+a.length,e+a.length)}}else{if(document.selection){b=document.selection.createRange();if(b.parentElement()==d){c=b.text=="";b.text=a;if(!c){b.moveStart("character",-a.length);b.select()}}}}}function getObject(){var a="";a=getSelectedText();if(a==""){alert(mydbr_loc.MYDBR_SQLEDIT_SELECT_OBJECT);return false}edit_obj(a);return true}function edit_obj(c,b){var e,a,d;if(b===undefined){e=""}else{e=b}$.ajax({url:"apps/getobject.php",type:"post",data:{object:c,db:e},success:function(f){if(f!=""){editor_tab_new(c,f)}else{$.ajax({url:"apps/cmdhelper.php",type:"get",data:{cmd:c},success:function(g){if(g!=""){window.open(g)}else{if(c.substr(0,6)=="sp_DBR"){if(confirm(sprintf(mydbr_loc.MYDBR_SQLEDIT_NO_OBJECT,c)+mydbr_loc.MYDBR_SQLEDIT_CREATE_IT)){if($("#db_vendor").val()=="mysql"){a="()\n";d=3}else{a="\nas\n";d=4}editor_tab_new(c,"create procedure "+c+a+"begin\n\n\n\nend");while(d>0){editor.execCommand("goLineDown");d--}}}else{alert(sprintf(mydbr_loc.MYDBR_SQLEDIT_NO_OBJECT,c))}}}})}},error:function(){alert("Unable to search for the object.")}});return true}function scroll(){$("#linenumb")[0].scrollTop=$("#proc_editor")[0].scrollTop}function resize(a,b){newHeight=$("#proc_editor").height()+parseInt($(this).css("top"),10);$("#proc_editor, #linenumb").height(newHeight);$(this).css("top","0px")};