var mixedMode={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]};$(document).ready(function(){window.editor=CodeMirror.fromTextArea(document.getElementById("cssfile"),{mode:"css",selectionPointer:true,styleActiveLine:true,autoCloseBrackets:true,matchBrackets:true,indentWithTabs:!editor_prefs.indent_with_space,smartIndent:false,lineNumbers:true,matchBrackets:true,autofocus:true,indentUnit:2,keyMap:editor_prefs.keymap,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],fold:"indent",foldGutter:{rangeFinder:new CodeMirror.fold.combine(CodeMirror.fold.indent,CodeMirror.fold.comment)},extraKeys:{"Ctrl-Space":"autocomplete","Shift-Tab":"indentLess","Ctrl-Q":function(b){b.foldCode(b.getCursor())},Tab:"indentMore",Esc:function(b){if(b.getOption("fullScreen")){b.setOption("fullScreen",false)}},"Ctrl-S":savefile,"Cmd-S":savefile,"Ctrl-F":editor_search_find,"Cmd-F":editor_search_find,"Ctrl-Alt-F":editor_search_find,"Cmd-Alt-F":editor_search_find},theme:editor_prefs.theme});window.buffers={};$(document).on("click","li.directory",function(){return false});$(document).on("click","li.file, li.file_remote",function(){var d,b,f,c,e;b=$(this).find("span:first").text();f=$(this).attr("data-filename");c=$(this).attr("data-ext");e=$(this).hasClass("file_remote")?1:0;d="";if($.inArray(c,["png","svg","jpg","jpeg","gif"])>=0){d="image"}if($.inArray(c,["css","php","js","xml","sql","html","txt"])>=0){d="file";if(c=="txt"){c="text/plain"}}if(d==""){d="file";c="text/plain"}$.ajax({url:"apps_v/fileedit_get.php",type:"get",data:{file:f,remote:e},success:function(i){var h,k,j,g;if(d=="image"){g='<div class="area_toolbar" id="toolbar_1"><div>';g+=editor_add_button("delete_image",mydbr_loc.MYDBR_SQLEDIT_DELETE_FILE,f);g+="</div></div>";$("#image").text("").prepend(g+'<img alt="preview" src="'+f+'">');select_editor_area("image");setTimeout(function(){h=$("#image>img")[0].naturalWidth;k=$("#image>img")[0].naturalHeight;if(h>0&&k>0){$("#image_preview > .size").html('<input size="80" value="<img src=&quot;'+f+"&quot height=&quot;"+k+"&quot; width=&quot;"+h+'&quot; alt=&quot;&quot;>">')}else{$("#image_preview > .size").text("")}},100)}else{select_editor_area("editor");$("#editor").css("display","block");j=c;if(j=="html"){j=mixedMode}editor_tab_new(b,i,f);editor.setOption("mode",j)}if(e==1){$("#file_edit_remote_help").dialog()}}});return false});resize_codemirror(0,110);var a=true;$(window).resize(function(){if(a){resize_codemirror(1,110)}});$(document).on("click","#save",savefile);$(document).on("click","#search",function(b){editor_search_find()});$(document).on("click","#word_wrap",function(){window.editor.setOption("lineWrapping",!window.editor.getOption("lineWrapping"))});$(document).on("click","#fullscreen",function(){window.editor.setOption("fullScreen",!window.editor.getOption("fullScreen"))});$(document).on("click","#delete_file",function(){editor_delete_file(this)});$(document).on("click","#new_document",function(){editor_new_document()});$(document).on("click","#new_directory",function(){editor_new_directory()});$(document).on("click","#a_delete_directory",function(){editor_rm_directory()});$(document).on("click","#delete_image",function(){editor_delete_image(this)});$(".dir_tree").find("ul").hide();$(document).on("click","li.directory",function(){var b=this,d=this,c;c=$(b).hasClass("opened");$(this).find("ul:first").slideToggle(300,function(){$(d).toggleClass("opened")});if(c){b=$(b).parent().closest(".directory");if(b.length==0){b=null}}file_upload_dir_set(b?$(b).attr("data-filename"):"user");select_editor_area("folder");return false});$(document).on("click","#tab_browsing_list div.tab",function(){editor_tab_select($(this).closest("li"))});$(document).on("click","#tab_browsing_list div.close",function(){editor_tab_close($(this).closest("li"));if($("#tab_browsing_list").children().length==0){select_editor_area("folder");file_upload_dir_set("user")}});select_editor_area("folder");file_upload_dir_set("user");Dropzone.options.dropzone={init:function(){this.on("success",function(b,c){this.removeAllFiles();var d=jQuery.parseJSON(c);show_message(d);if(d.tree){directory_tree_refesh(d.tree);$('.file[data-filename="'+d.filename+'"]').click()}})}}});function editor_delete_image(a){editor_delete_file_gen($(a).attr("data-filename"))}function editor_new_directory(){var a;a=prompt(mydbr_loc.MYDBR_SQLEDIT_DIRECTORYNAME);if(a){$.ajax({url:"apps_v/fileedit_v.php",type:"post",data:{action:"new_directory",name:$("#upload_path").val()+"/"+a,csrf_token:csrf_token_get()},success:function(b){var c=jQuery.parseJSON(b);show_message(c);if(c.tree){directory_tree_refesh(c.tree)}}})}}function editor_rm_directory(){var a=$("#upload_path").val();if($('.dir_tree [data-filename="'+a+'"]').attr("data-mydbr-uses")=="1"){alert(sprintf(mydbr_loc.MYDBR_SQLEDIT_USED_BY_MYDBR_DIR,a));return}if(confirm(sprintf(mydbr_loc.MYDBR_SQLEDIT_REMOVE_DIRECTORY,a))){$.ajax({url:"apps_v/fileedit_v.php",type:"post",data:{action:"delete_directory",directory:a,csrf_token:csrf_token_get()},success:function(b){var c=jQuery.parseJSON(b);show_message(c);if(c.tree){directory_tree_refesh(c.tree)}file_upload_dir_set("user")}})}}function editor_new_document(){var a,b;select_editor_area("editor");a=prompt(mydbr_loc.MYDBR_SQLEDIT_FILENAME);if(a){b=$("#upload_path").val()+"/"+a;editor_tab_new(a,"",b)}}function directory_tree_refesh(b){var a=[];$(".directory.opened").each(function(){a.push($(this).attr("data-filename"))});$("#user_directory").html(b);$(".dir_tree").find("ul").hide();$.each(a,function(c,d){$('.directory[data-filename="'+d+'"]').addClass("opened").find("ul").css("display","block")})}function editor_delete_file(a){editor_delete_file_gen($("#tab_browsing_list li.selected").attr("data-filename"))}function editor_delete_file_gen(a){if($('.dir_tree [data-filename="'+a+'"]').attr("data-mydbr-uses")=="1"){alert(sprintf(mydbr_loc.MYDBR_SQLEDIT_USED_BY_MYDBR_FILE,a));return}if($('.dir_tree [data-filename="'+a+'"]').length==0){editor_delete_file_finish();return}if(confirm(sprintf(mydbr_loc.MYDBR_SQLEDIT_DELETE_FILE,a))){$.ajax({url:"apps_v/fileedit_v.php",type:"post",data:{action:"delete_file",delete_file:a,csrf_token:csrf_token_get()},success:function(b){var c=jQuery.parseJSON(b);show_message(c);if(c.tree){directory_tree_refesh(c.tree)}editor_delete_file_finish()}})}}function editor_delete_file_finish(){editor_tab_close($("#tab_browsing_list li.selected"));if($("#tab_browsing_list").children().length==0||$("#image_preview").css("diplay")!="none"){select_editor_area("folder");if($("#upload_path").val()==""){file_upload_dir_set("user")}}}function editor_add_button(b,c,a){if(typeof a==="undefined"){a=""}else{a=' data-filename="'+a+'"'}return'<a id="a_'+b+'" href="javascript:void(0)"><div id="'+b+'" class="action editor_btn"'+a+' title="'+c+'"></div></a>'}function file_upload_dir_set(c){var a,d=true;a='<div class="area_toolbar" id="toolbar_1"><div>';a+=editor_add_button("new_document",mydbr_loc.MYDBR_SQLEDIT_NEW_TAB);a+=editor_add_button("new_directory",mydbr_loc.MYDBR_SQLEDIT_NEW_DIRECTORY);if($('.dir_tree [data-filename="'+c+'"]').attr("data-mydbr-uses")=="1"){d=false}if(c!=="user"&&d){a+=editor_add_button("delete_directory",mydbr_loc.MYDBR_SQLEDIT_REMOVE_DIRECTORY)}a+="</div></div>";$("#fileupload_dir_name").text(c).prepend(a);$("#upload_path").val(c)}function select_editor_area(a){if(a=="editor"){$("#editor").css("display","block")}else{$("#editor").css("display","none")}if(a=="image"){$("#image_preview").css("display","block")}else{$("#image_preview").css("display","none").find("#image").html("")}if(a=="folder"){$("#fileupload").css("display","block")}else{$("#fileupload").css("display","none")}}function show_message(b){var a;if(b.ok||b.error){a=900;$.blockUI.defaults.growlCSS.width="auto";$.blockUI.defaults.growlCSS.top="40px";$.blockUI.defaults.growlCSS.left="5px";$.blockUI.defaults.growlCSS.right="";$.blockUI.defaults.growlCSS.opacity=0.9;$.blockUI.defaults.growlCSS.backgroundColor="#00C42E";$.blockUI.defaults.growlCSS.borderRadius="5px";if(b.error!==null){a=5000;$.blockUI.defaults.growlCSS.backgroundColor="red"}$.growlUI(null,(b.error?b.error:b.ok),a)}}function savefile(){$.ajax({url:"apps_v/fileedit_v.php",type:"post",data:{action:"save_file",content:editor.getValue(),file:$("#tab_browsing_list li.selected").attr("data-filename"),csrf_token:csrf_token_get()},success:function(a){var b=jQuery.parseJSON(a);show_message(b);if(b.tree){directory_tree_refesh(b.tree)}}})};